<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rbi">
<title>Introduction to rbi • rbi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to rbi">
<meta property="og:description" content="rbi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rbi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/rbi.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/idd_models.html">Collection of SIR models for LibBi</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sbfnk/rbi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to rbi</h1>
                        <h4 data-toc-skip class="author">Sebastian
Funk</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/sbfnk/rbi/blob/HEAD/vignettes/rbi.Rmd" class="external-link"><code>vignettes/rbi.Rmd</code></a></small>
      <div class="d-none name"><code>rbi.Rmd</code></div>
    </div>

    
    
<p>This vignette gives an introduction to using <strong>rbi</strong>.
For the best viewing experience, use the <a href="https://sbfnk.github.io/rbi/articles/introduction.html">version on
the rbi website</a>.</p>
<p><a href="https://github.com/sbfnk/rbi" class="external-link">rbi</a> is an <code>R</code>
interface to <a href="https://libbi.org" class="external-link">LibBi</a>, a library for
Bayesian inference with state-space models using high-performance
computer hardware.</p>
<p>The package has been tested on macOS and Linux. It requires a working
installation of <strong>LibBi</strong>. On macOS, this is easiest done
using the <code>brew</code> command: Install <a href="https://brew.sh" class="external-link">Homebrew</a>, then issue the following command
(using a command shell, i.e. Terminal or similar):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">brew</span> install libbi</span></code></pre></div>
<p>On linux, follow the <a href="https://github.com/lawmurray/LibBi/blob/master/INSTALL_LINUX.md" class="external-link">instructions</a>
provided with LibBi.</p>
<p>If you have any trouble installing <strong>LibBi</strong> you can get
help on the <a href="https://groups.google.com/forum/#!forum/libbi-users" class="external-link">LibBi
Users</a> mailing list.</p>
<p>The path to the <code>libbi</code> script can be passed as an
argument to <strong>rbi</strong>, otherwise the package tries to find it
automatically using the <code>which</code> linux/unix command.</p>
<p>If you just want to process the output from <strong>LibBi</strong>,
then you do not need to have <strong>LibBi</strong> installed.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The easiest way to install the latest stable version of
<strong>rbi</strong> is via CRAN.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rbi"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, the current development version can be installed using
the <code>remotes</code> package</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"sbfnk/rbi"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-the-package">Loading the package<a class="anchor" aria-label="anchor" href="#loading-the-package"></a>
</h2>
<p>Use</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/sbfnk/rbi" class="external-link">"rbi"</a></span><span class="op">)</span></span></code></pre></div>
<p>to load the package.</p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>The main computational engine and model grammar behind
<strong>rbi</strong> is provided by <strong>LibBi</strong>. The <a href="https://libbi.org/docs/LibBi-Manual.pdf" class="external-link">LibBi manual</a> is a
good place to start for finding out everything there is to know about
<strong>LibBi</strong> models and inference methods.</p>
<p>The <strong>rbi</strong> package mainly provides two classes:
<code>bi_model</code> and <code>libbi</code>. The <code>bi_model</code>
class is used to load, view and manipulate <strong>LibBi</strong> model
files. The <code>libbi</code> class is used to run LibBi and perform
inference.</p>
<p>The package also provides two methods for interacting with the <a href="https://www.unidata.ucar.edu/software/netcdf/" class="external-link">NetCDF</a> files
used by <strong>LibBi</strong>, <code>bi_read</code> and
<code>bi_write</code>. Lastly, it provides a <code>get_traces</code>
function to analyse Markov-chain Monte Carlo (MCMC) traces using the <a href="https://cran.r-project.org/package=coda" class="external-link">coda</a> package.</p>
</div>
<div class="section level2">
<h2 id="the-bi_model-class">The <code>bi_model</code> class<a class="anchor" aria-label="anchor" href="#the-bi_model-class"></a>
</h2>
<p>As an example, we consider a simplified version of the SIR model
discussed in <a href="https://arxiv.org/abs/1405.4081" class="external-link">Del Moral et
al. (2014)</a>. This is included with the <strong>rbi</strong> package
and can be loaded with</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"rbi"</span>, <span class="st">"SIR.bi"</span><span class="op">)</span></span>
<span><span class="va">sir_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_model.html">bi_model</a></span><span class="op">(</span><span class="va">model_file</span><span class="op">)</span> <span class="co"># load model</span></span></code></pre></div>
<p>Other ways of implementing a (deterministic or stochastic) SIR model
can be found in the <a href="idd_models.html">collection of SIR models
for LibBi</a>, where you also find how to load them into a
<code>bi_model</code> object, e.g. <code>sir_model</code>. Feel free to
run the commands below with different versions of the model.</p>
<p>The <code>sir_model</code> object now contains the model, which can
be displayed with</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_model</span></span>
<span><span class="co">#&gt; bi_model:</span></span>
<span><span class="co">#&gt; =========</span></span>
<span><span class="co">#&gt;  1: model SIR {</span></span>
<span><span class="co">#&gt;  2:   const h = 7</span></span>
<span><span class="co">#&gt;  3:   const N = 1000</span></span>
<span><span class="co">#&gt;  4:   const d_infection = 14</span></span>
<span><span class="co">#&gt;  5:   noise n_transmission</span></span>
<span><span class="co">#&gt;  6:   noise n_recovery</span></span>
<span><span class="co">#&gt;  7:   state S</span></span>
<span><span class="co">#&gt;  8:   state I</span></span>
<span><span class="co">#&gt;  9:   state R</span></span>
<span><span class="co">#&gt; 10:   state Z</span></span>
<span><span class="co">#&gt; 11:   obs Incidence</span></span>
<span><span class="co">#&gt; 12:   param p_rep</span></span>
<span><span class="co">#&gt; 13:   param p_R0</span></span>
<span><span class="co">#&gt; 14:   sub parameter {</span></span>
<span><span class="co">#&gt; 15:     p_rep ~ uniform(0,1)</span></span>
<span><span class="co">#&gt; 16:     p_R0 ~ uniform(1,3)</span></span>
<span><span class="co">#&gt; 17:   }</span></span>
<span><span class="co">#&gt; 18:   sub initial {</span></span>
<span><span class="co">#&gt; 19:     S &lt;- N - 1</span></span>
<span><span class="co">#&gt; 20:     I &lt;- 1</span></span>
<span><span class="co">#&gt; 21:     R &lt;- 0</span></span>
<span><span class="co">#&gt; 22:     Z &lt;- 1</span></span>
<span><span class="co">#&gt; 23:   }</span></span>
<span><span class="co">#&gt; 24:   sub transition {</span></span>
<span><span class="co">#&gt; 25:     n_transmission ~ wiener()</span></span>
<span><span class="co">#&gt; 26:     n_recovery ~ wiener()</span></span>
<span><span class="co">#&gt; 27:     Z &lt;- (t_now % 7 == 0 ? 0 : Z)</span></span>
<span><span class="co">#&gt; 28:     inline i_beta = p_R0 / d_infection * exp(n_transmission)</span></span>
<span><span class="co">#&gt; 29:     inline i_gamma = 1 / d_infection * exp(n_recovery)</span></span>
<span><span class="co">#&gt; 30:     ode (alg='RK4(3)', h=1e-1, atoler=1e-2, rtoler=1e-5) {</span></span>
<span><span class="co">#&gt; 31:       dS/dt = - i_beta * S * I / N</span></span>
<span><span class="co">#&gt; 32:       dI/dt = i_beta * S * I / N - i_gamma * I</span></span>
<span><span class="co">#&gt; 33:       dR/dt = i_gamma * I</span></span>
<span><span class="co">#&gt; 34:       dZ/dt = i_beta * S * I / N</span></span>
<span><span class="co">#&gt; 35:     }</span></span>
<span><span class="co">#&gt; 36:   }</span></span>
<span><span class="co">#&gt; 37:   sub observation {</span></span>
<span><span class="co">#&gt; 38:     Incidence ~ poisson(p_rep * Z)</span></span>
<span><span class="co">#&gt; 39:   }</span></span>
<span><span class="co">#&gt; 40:   sub proposal_initial {</span></span>
<span><span class="co">#&gt; 41:     S &lt;- N - 1</span></span>
<span><span class="co">#&gt; 42:     I &lt;- 1</span></span>
<span><span class="co">#&gt; 43:     R &lt;- 0</span></span>
<span><span class="co">#&gt; 44:     Z &lt;- 1</span></span>
<span><span class="co">#&gt; 45:   }</span></span>
<span><span class="co">#&gt; 46:   sub proposal_parameter {</span></span>
<span><span class="co">#&gt; 47:     p_rep ~ truncated_gaussian(mean = p_rep, std = 0.03, lower = 0, upper = 1)</span></span>
<span><span class="co">#&gt; 48:     p_R0 ~ truncated_gaussian(mean = p_R0, std = 0.2, lower = 1, upper = 3)</span></span>
<span><span class="co">#&gt; 49:   }</span></span>
<span><span class="co">#&gt; 50: }</span></span></code></pre></div>
<p>A part of the model can be shown with, for example,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_model</span><span class="op">[</span><span class="fl">35</span><span class="op">:</span><span class="fl">38</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "}"                              "}"                             </span></span>
<span><span class="co">#&gt; [3] "sub observation {"              "Incidence ~ poisson(p_rep * Z)"</span></span></code></pre></div>
<p>or, for example,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_block.html">get_block</a></span><span class="op">(</span><span class="va">sir_model</span>, <span class="st">"parameter"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "p_rep ~ uniform(0,1)" "p_R0 ~ uniform(1,3)"</span></span></code></pre></div>
<p>To get a list of certain variables, you can use the
<code>var_names</code> function. For example, to get a list of states,
you can use</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/var_names.html">var_names</a></span><span class="op">(</span><span class="va">sir_model</span>, type <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "S" "I" "R" "Z"</span></span></code></pre></div>
<p>There are also various methods for manipulating a model, such as
<code>remove_lines</code>, <code>insert_line</code>,
<code>replace_all</code>.</p>
<p>The <code>fix</code> method fixes a variable to one value. This can
be useful, for example, to run the deterministic equivalent of a
stochastic model for testing purposes:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">det_sir_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix.html">fix</a></span><span class="op">(</span><span class="va">sir_model</span>, n_transmission <span class="op">=</span> <span class="fl">0</span>, n_recovery <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>To get documentation for any of these methods, use the links in the
documentation for <code>bi_model</code>.</p>
</div>
<div class="section level2">
<h2 id="generating-a-dataset">Generating a dataset<a class="anchor" aria-label="anchor" href="#generating-a-dataset"></a>
</h2>
<p>First, let’s create a data set from the SIR model.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1001912</span><span class="op">)</span></span>
<span><span class="va">sir_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span><span class="va">sir_model</span>, end_time <span class="op">=</span> <span class="fl">16</span> <span class="op">*</span> <span class="fl">7</span>, noutputs <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p>This simulates the model a single time from time 0 until time 16*7
(say, 16 weeks with a daily time step), producing 16 outputs (one a
week). Note that we have specified a random seed to make this document
reproducible. If you omit the <code>set.seed</code> command or set it to
a different number, the results will be different even when run with the
same set of commands. Also note that <em>LibBi</em> compiles the model
code only the first time it is run. If you run the command above a
second time, it should run much faster.</p>
<p>The <code>generate_dataset</code> function returns a
<code>libbi</code> object:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sir_data</span></span>
<span><span class="co">#&gt; Wrapper around LibBi</span></span>
<span><span class="co">#&gt; ======================</span></span>
<span><span class="co">#&gt; Model:  SIR </span></span>
<span><span class="co">#&gt; Run time:  0.002298  seconds</span></span>
<span><span class="co">#&gt; Number of samples:  1 </span></span>
<span><span class="co">#&gt; State trajectories recorded:  S I R Z </span></span>
<span><span class="co">#&gt; Noise trajectories recorded:  n_transmission n_recovery </span></span>
<span><span class="co">#&gt; Observation trajectories recorded:  Incidence </span></span>
<span><span class="co">#&gt; Parameters recorded:  p_rep p_R0</span></span></code></pre></div>
<p>The generated dataset can be viewed and/or stored in a variable using
<code>bi_read</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_read.html">bi_read</a></span><span class="op">(</span><span class="va">sir_data</span><span class="op">)</span></span></code></pre></div>
<p>The <code>bi_read</code> function takes the name of a NetCDF file or
a <code>libbi</code> object (in which case it locates the output file)
and stores the contents in a list of data frames or vectors, depending
on the dimensionality of the contents. Note that, if no
<code>working_folder</code> is specified, the model and output files
will be stored in a temporary folder.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "n_transmission" "n_recovery"     "S"              "I"             </span></span>
<span><span class="co">#&gt;  [5] "R"              "Z"              "Incidence"      "p_rep"         </span></span>
<span><span class="co">#&gt;  [9] "p_R0"           "clock"</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span><span class="op">$</span><span class="va">p_R0</span></span>
<span><span class="co">#&gt;      value</span></span>
<span><span class="co">#&gt; 1 2.269623</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span></span>
<span><span class="co">#&gt;    time value</span></span>
<span><span class="co">#&gt; 1     0     1</span></span>
<span><span class="co">#&gt; 2     7     0</span></span>
<span><span class="co">#&gt; 3    14     1</span></span>
<span><span class="co">#&gt; 4    21     3</span></span>
<span><span class="co">#&gt; 5    28    46</span></span>
<span><span class="co">#&gt; 6    35   120</span></span>
<span><span class="co">#&gt; 7    42    97</span></span>
<span><span class="co">#&gt; 8    49    48</span></span>
<span><span class="co">#&gt; 9    56     2</span></span>
<span><span class="co">#&gt; 10   63     3</span></span>
<span><span class="co">#&gt; 11   70     0</span></span>
<span><span class="co">#&gt; 12   77     0</span></span>
<span><span class="co">#&gt; 13   84     0</span></span>
<span><span class="co">#&gt; 14   91     0</span></span>
<span><span class="co">#&gt; 15   98     0</span></span>
<span><span class="co">#&gt; 16  105     0</span></span>
<span><span class="co">#&gt; 17  112     0</span></span></code></pre></div>
<p>We can visualise the generated incidence data with</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span><span class="op">$</span><span class="va">time</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span><span class="op">$</span><span class="va">time</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span><span class="op">$</span><span class="va">value</span><span class="op">)</span></span></code></pre></div>
<p><img src="rbi_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="the-libbi-class">The <code>libbi</code> class<a class="anchor" aria-label="anchor" href="#the-libbi-class"></a>
</h2>
<p>The <code>libbi</code> class manages the interaction with
<strong>LibBi</strong> such as sampling from the prior or posterior
distribution. For example, the <code>sir_data</code> object above is of
type <code>libbi</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">sir_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "libbi"</span></span></code></pre></div>
<p>Th <code>bi_generate_dataset</code> is one particular way of
generating a <code>libbi</code> object, used only to generate test data
from a model. The standard way of creating a <code>libbi</code> object
for Bayesian inference is using the <code>libbi</code> command</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/libbi.html">libbi</a></span><span class="op">(</span><span class="va">sir_model</span><span class="op">)</span></span></code></pre></div>
<p>This initialises a <code>libbi</code> object with the model created
earlier and assigns it to the variable <code>bi</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">bi</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "libbi"</span></span></code></pre></div>
<p>Let’s sample from the prior of the SIR model:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample.html">sample</a></span><span class="op">(</span></span>
<span>  <span class="va">bi</span>, target <span class="op">=</span> <span class="st">"prior"</span>, nsamples <span class="op">=</span> <span class="fl">1000</span>, end_time <span class="op">=</span> <span class="fl">16</span> <span class="op">*</span> <span class="fl">7</span>, noutputs <span class="op">=</span> <span class="fl">16</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This step calls <strong>LibBi</strong> to sample from the prior
distribution of the previously specified model, generating 1,000 samples
and each time running the model for 16 * 7 = 112 time steps and writing
16 outputs (i.e., every 7 time steps). <strong>LibBi</strong> parses the
model, creates C++ code, compiles it and run the model. If the model is
run again, it should do so much quicker because it will use the already
compiled C++ code to run the model:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample.html">sample</a></span><span class="op">(</span><span class="va">bi_prior</span><span class="op">)</span></span></code></pre></div>
<p>The <code>sample</code> command returns an updated <code>libbi</code>
object which, in this case, we just assign again to the <code>bi</code>
object. Any call of <code>sample</code> preserves options passed to the
previous call of <code>sample</code> and <code>libbi</code>, unless they
are overwritten by arguments passed to <code>sample</code> (e.g.,
passing a new <code>nsamples</code> argument). Let’s have a closer look
at the <code>bi</code> object:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi_prior</span></span>
<span><span class="co">#&gt; Wrapper around LibBi</span></span>
<span><span class="co">#&gt; ======================</span></span>
<span><span class="co">#&gt; Model:  SIR </span></span>
<span><span class="co">#&gt; Run time:  0.059634  seconds</span></span>
<span><span class="co">#&gt; Number of samples:  1000 </span></span>
<span><span class="co">#&gt; State trajectories recorded:  S I R Z </span></span>
<span><span class="co">#&gt; Noise trajectories recorded:  n_transmission n_recovery </span></span>
<span><span class="co">#&gt; Parameters recorded:  p_rep p_R0</span></span></code></pre></div>
<p>To see even more detail, try</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bi_prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 21</span></span>
<span><span class="co">#&gt;  $ options         :List of 5</span></span>
<span><span class="co">#&gt;   ..$ build-dir: chr "/tmp/RtmpDyVGLT/SIR3b6533dab0c8"</span></span>
<span><span class="co">#&gt;   ..$ seed     : num 3.33e+08</span></span>
<span><span class="co">#&gt;   ..$ nsamples : num 1000</span></span>
<span><span class="co">#&gt;   ..$ end-time : num 112</span></span>
<span><span class="co">#&gt;   ..$ noutputs : num 16</span></span>
<span><span class="co">#&gt;  $ path_to_libbi   : chr "/usr/local/bin/libbi"</span></span>
<span><span class="co">#&gt;  $ model           : 'bi_model' chr [1:50] "model SIR {" "const h = 7" "const N = 1000" "const d_infection = 14" ...</span></span>
<span><span class="co">#&gt;  $ model_file_name : chr "/tmp/RtmpDyVGLT/SIR3b6533dab0c8/SIR.bi"</span></span>
<span><span class="co">#&gt;  $ dims            : list()</span></span>
<span><span class="co">#&gt;  $ time_dim        : chr(0) </span></span>
<span><span class="co">#&gt;  $ coord_dims      : list()</span></span>
<span><span class="co">#&gt;  $ thin            : num 1</span></span>
<span><span class="co">#&gt;  $ output_every    : num NA</span></span>
<span><span class="co">#&gt;  $ debug           : logi FALSE</span></span>
<span><span class="co">#&gt;  $ command         : chr "/usr/local/bin/libbi sample --build-dir /tmp/RtmpDyVGLT/SIR3b6533dab0c8 --seed 332755949 --target prior --nsamp"| __truncated__</span></span>
<span><span class="co">#&gt;  $ output_file_name: chr "/tmp/RtmpDyVGLT/SIR3b6533dab0c8/SIR_output3b653b5bad8a.nc"</span></span>
<span><span class="co">#&gt;  $ log_file_name   : chr "/tmp/RtmpDyVGLT/SIR3b6533dab0c8/output3b65454d1e57.txt"</span></span>
<span><span class="co">#&gt;  $ user_log_file   : logi FALSE</span></span>
<span><span class="co">#&gt;  $ timestamp       :List of 1</span></span>
<span><span class="co">#&gt;   ..$ output: POSIXct[1:1], format: "2024-06-01 06:19:44"</span></span>
<span><span class="co">#&gt;  $ run_flag        : logi TRUE</span></span>
<span><span class="co">#&gt;  $ error_flag      : logi FALSE</span></span>
<span><span class="co">#&gt;  $ use_cache       : logi TRUE</span></span>
<span><span class="co">#&gt;  $ supplement      : NULL</span></span>
<span><span class="co">#&gt;  $ .gc_env         :&lt;environment: 0x56087d7a9010&gt; </span></span>
<span><span class="co">#&gt;  $ .cache          :&lt;environment: 0x56087ddb9490&gt; </span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr "libbi"</span></span></code></pre></div>
<p>We can see the object contains 14 fields, including the model, the
path to the <code>libbi</code> script, and the command used to run libbi
(<code>bi$command</code>); the <code>options</code> field contains all
the options that <strong>LibBi</strong> was called with. This includes
the ones we passed to <code>sample</code></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi_prior</span><span class="op">$</span><span class="va">options</span></span>
<span><span class="co">#&gt; $`build-dir`</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpDyVGLT/SIR3b6533dab0c8"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $seed</span></span>
<span><span class="co">#&gt; [1] 332755949</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $nsamples</span></span>
<span><span class="co">#&gt; [1] 1000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`end-time`</span></span>
<span><span class="co">#&gt; [1] 112</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $noutputs</span></span>
<span><span class="co">#&gt; [1] 16</span></span></code></pre></div>
<p>The other fields contain various bits of information about the
object, including the model used, the command used to run
<strong>LibBi</strong> (<code>bi$command</code>) and the output file
name:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi_prior</span><span class="op">$</span><span class="va">output_file_name</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpDyVGLT/SIR3b6533dab0c8/SIR_output3b653b5bad8a.nc"</span></span></code></pre></div>
<p>We can get the results of the sampling run using
<code>bi_read</code></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_read.html">bi_read</a></span><span class="op">(</span><span class="va">bi_prior</span><span class="op">$</span><span class="va">output_file_name</span><span class="op">)</span></span></code></pre></div>
<p>or with the shorthand</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_read.html">bi_read</a></span><span class="op">(</span><span class="va">bi_prior</span><span class="op">)</span></span></code></pre></div>
<p>which looks at the <code>output_file_name</code> field to read in the
data. Let’s look at the returned object</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">prior</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 9</span></span>
<span><span class="co">#&gt;  $ n_transmission:'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 0 -1.548 0.183 -0.361 0.408 ...</span></span>
<span><span class="co">#&gt;  $ n_recovery    :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 0 0.014 0.42 -2.066 -1.207 ...</span></span>
<span><span class="co">#&gt;  $ S             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 999 999 998 998 997 ...</span></span>
<span><span class="co">#&gt;  $ I             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 1 0.847 0.609 0.588 0.816 ...</span></span>
<span><span class="co">#&gt;  $ R             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 0 0.635 1.31 1.674 1.978 ...</span></span>
<span><span class="co">#&gt;  $ Z             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 1 0.483 0.437 0.343 0.532 ...</span></span>
<span><span class="co">#&gt;  $ p_rep         :'data.frame':  1000 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:1000] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:1000] 0.717 0.215 0.969 0.504 0.894 ...</span></span>
<span><span class="co">#&gt;  $ p_R0          :'data.frame':  1000 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:1000] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:1000] 1.14 2.29 1.27 2.37 1.68 ...</span></span>
<span><span class="co">#&gt;  $ clock         : num 59634</span></span></code></pre></div>
<p>This is a list of 9 objects, 8 representing each of the (noise/state)
variables and parameters in the file, and one number <code>clock</code>,
representing the time spent running the model in microseconds.</p>
<p>We can see that the time-varying variables are represented as data
frames with three columns: <code>np</code> (enumerating individual
simulations), <code>time</code> and <code>value</code>. Parameters don’t
vary in time and just have <code>np</code> and <code>value</code>
columns.</p>
</div>
<div class="section level2">
<h2 id="fitting-a-model-to-data-using-pmcmc">Fitting a model to data using PMCMC<a class="anchor" aria-label="anchor" href="#fitting-a-model-to-data-using-pmcmc"></a>
</h2>
<p>Let’s perform inference using Particle Markov-chain Metropolis
Hastings (PMMH). The following command will generate 16 * 10,000 =
160,000 simulations and therefore may take a little while to run (if you
want to see the samples progress, use <code>verbose=TRUE</code> in the
<code>sample</code> call).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample.html">sample</a></span><span class="op">(</span><span class="va">bi_prior</span>, target <span class="op">=</span> <span class="st">"posterior"</span>, nparticles <span class="op">=</span> <span class="fl">32</span>, obs <span class="op">=</span> <span class="va">sir_data</span><span class="op">)</span></span></code></pre></div>
<p>This samples from the posterior distribution. Remember that options
are preserved from previous runs (because we passed the <code>bi</code>)
as first argument, so we don’t need to specify <code>nsamples</code>,
<code>end_time</code> and <code>noutputs</code> again, unless we want to
change them. The <code>nparticles</code> option specifies the number of
particles.</p>
<p>You can also pass a list of data frames (each element of the list
corresponding to one observed variable as the <code>obs</code> argument,
for example</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">7</span>, <span class="fl">14</span>, <span class="fl">21</span>, <span class="fl">28</span>, <span class="fl">35</span>, <span class="fl">42</span>, <span class="fl">49</span>, <span class="fl">56</span>, <span class="fl">63</span>, <span class="fl">70</span>, <span class="fl">77</span>, <span class="fl">84</span>, <span class="fl">91</span>, <span class="fl">98</span>, <span class="fl">105</span>, <span class="fl">112</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">26</span>, <span class="fl">99</span>, <span class="fl">57</span>, <span class="fl">78</span>, <span class="fl">57</span>, <span class="fl">15</span>, <span class="fl">9</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bi_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample.html">sample</a></span><span class="op">(</span></span>
<span>  <span class="va">bi_prior</span>, target <span class="op">=</span> <span class="st">"posterior"</span>, nparticles <span class="op">=</span> <span class="fl">32</span>, obs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Incidence <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Input, init and observation files (see the <a href="https://libbi.org/docs/LibBi-Manual.pdf" class="external-link">LibBi manual</a> for
details) can be specified using the <code>init</code>,
<code>input</code>, <code>obs</code> options, respectively. They can
each be specified either as the name of a NetCDF file containing the
data, or a <code>libbi</code> object (in which case the output file will
be taken) or directly via an appropriate <code>R</code> object
containing the data (e.g., a character vector of length one, or a list
of data frames or numeric vectors). In the case of the command above,
<code>init</code> is specified as a list, and <code>obs</code> as a
<code>libbi</code> object. The <code>Incidence</code> variable of the
<code>sir_data</code> object will be taken as observations.</p>
<p>The time dimension (or column, if a data frame) in the passed
<code>init</code>, <code>input</code> and/or <code>obs</code> files can
be specified using the <code>time_dim</code> option. If this is not
given, it will be assumed to be <code>time</code>, if such a dimension
exists or, if not, any numeric column not called <code>value</code> (or
the contents of the <code>value_column</code> option). If this does not
produce a unique column name, an error will be thrown. All other
dimensions/columns in the passed options will be interpreted as
additional dimensions in the data, and stored in the <code>dims</code>
field of the <code>libbi</code> object.</p>
<p>Any other options (apart from <code>log_file_name</code>, see the <a href="#debugging">Debugging</a> section) will be passed on to the
command <code>libbi</code> – for a complete list, see the <a href="https://libbi.org/docs/LibBi-Manual.pdf" class="external-link">LibBi manual</a>. Hyphens
can be replaced by underscores so as not to confuse R (see
<code>end_time</code>). Any arguments starting with
<code>enable</code>/<code>disable</code> can be specified as boolean
(e.g., <code>assert=TRUE</code>). Any <code>dry-</code> options can be
specified with a <code>"dry"</code> argument, e.g.,
<code>parse="dry"</code>.</p>
</div>
<div class="section level2">
<h2 id="analysing-an-mcmc-run">Analysing an MCMC run<a class="anchor" aria-label="anchor" href="#analysing-an-mcmc-run"></a>
</h2>
<p>Let’s get the results of the preceding <code>sample</code>
command:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bi_contents.html">bi_contents</a></span><span class="op">(</span><span class="va">bi</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "time"           "n_transmission" "n_recovery"     "S"             </span></span>
<span><span class="co">#&gt;  [5] "I"              "R"              "Z"              "p_rep"         </span></span>
<span><span class="co">#&gt;  [9] "p_R0"           "clock"          "loglikelihood"  "logprior"</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_read.html">bi_read</a></span><span class="op">(</span><span class="va">bi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">posterior</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 11</span></span>
<span><span class="co">#&gt;  $ n_transmission:'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 0 0.204 -0.938 -1.049 1.34 ...</span></span>
<span><span class="co">#&gt;  $ n_recovery    :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 0 -2.105 0.49 0.866 1.438 ...</span></span>
<span><span class="co">#&gt;  $ S             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 999 998 983 501 276 ...</span></span>
<span><span class="co">#&gt;  $ I             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 1 1.47 11.71 396.01 277.32 ...</span></span>
<span><span class="co">#&gt;  $ R             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 0 0.623 5.348 103.185 446.216 ...</span></span>
<span><span class="co">#&gt;  $ Z             :'data.frame':  17000 obs. of  3 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:17000] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ time : num [1:17000] 0 7 14 21 28 35 42 49 56 63 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:17000] 1 1.1 15 482.1 224.3 ...</span></span>
<span><span class="co">#&gt;  $ p_rep         :'data.frame':  1000 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:1000] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:1000] 0.000231 0.014226 0.037137 0.037137 0.037137 ...</span></span>
<span><span class="co">#&gt;  $ p_R0          :'data.frame':  1000 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:1000] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:1000] 2.23 2.25 1.77 1.77 1.77 ...</span></span>
<span><span class="co">#&gt;  $ clock         : num 5796949</span></span>
<span><span class="co">#&gt;  $ loglikelihood :'data.frame':  1000 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:1000] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:1000] -2381 -1321 -556 -556 -556 ...</span></span>
<span><span class="co">#&gt;  $ logprior      :'data.frame':  1000 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..$ np   : num [1:1000] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">#&gt;   ..$ value: num [1:1000] -0.693 -0.693 -0.693 -0.693 -0.693 ...</span></span></code></pre></div>
<p>We can see that this has two more objects than previously when we
specified <code>target="prior"</code>: <code>loglikelihood</code> (the
estimated log-likelihood of the parameters at each MCMC step) and
<code>logprior</code> (the estimated log-prior density of the parameters
at each MCMC step).</p>
<p>To get a summary of the parameters sampled, use</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">bi</span><span class="op">)</span></span>
<span><span class="co">#&gt;     var         Min.   1st Qu.    Median      Mean   3rd Qu.      Max.</span></span>
<span><span class="co">#&gt; 1 p_rep 0.0002305077 0.3178343 0.3330986 0.3303792 0.3444797 0.4158924</span></span>
<span><span class="co">#&gt; 2  p_R0 1.4064460854 2.2859129 2.6853853 2.5449143 2.8629936 2.9992701</span></span></code></pre></div>
<p>A summary of sampled trajectories can be obtained using</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">bi</span>, type <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span></code></pre></div>
<p>Any particular posterior sample can be viewed with
<code>extract_sample</code> (with indices running from 0 to
<code>nsamples - 1</code>):</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_sample.html">extract_sample</a></span><span class="op">(</span><span class="va">bi</span>, <span class="fl">314</span><span class="op">)</span></span></code></pre></div>
<p>To analyse MCMC outputs, we can use the <strong>coda</strong> package
and the <code>get_traces</code> function of <strong>rbi</strong>. Note
that, to get exactly the same traces, you would have to set the seed as
above.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"coda"</span><span class="op">)</span></span>
<span><span class="va">traces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_traces.html">get_traces</a></span><span class="op">(</span><span class="va">bi</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can, for example, visualise parameter traces and densities
with</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">traces</span><span class="op">)</span></span></code></pre></div>
<p><img src="rbi_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
<p>Compare this to the marginal posterior distributions to the “correct”
parameters used to generate the data set:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bi_read.html">bi_read</a></span><span class="op">(</span><span class="va">sir_data</span>, type <span class="op">=</span> <span class="st">"param"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $p_rep</span></span>
<span><span class="co">#&gt;       value</span></span>
<span><span class="co">#&gt; 1 0.3493278</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $p_R0</span></span>
<span><span class="co">#&gt;      value</span></span>
<span><span class="co">#&gt; 1 2.269623</span></span></code></pre></div>
<p>For more details on using <strong>coda</strong> to further analyse
the chains, see the website of the <a href="https://cran.r-project.org/package=coda" class="external-link">coda package</a>. For
more plotting functionality, the <a href="https://cran.r-project.org/package=ggmcmc" class="external-link">ggmcmc package</a> is
also worth considering.</p>
</div>
<div class="section level2">
<h2 id="predictions">Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h2>
<p>We can use the <code>predict</code> function to re-simulate the
fitted model using the estimated parameters, that is to generate samples
from <span class="math inline">\(p(x_t|\theta)\)</span> where the <span class="math inline">\(\theta\)</span> are distributed according to the
marginal posterior distribution <span class="math inline">\(p(\theta|y^*_t)\)</span> (here: <span class="math inline">\(\theta\)</span> are fixed parameters, <span class="math inline">\(x_t\)</span> are state trajectories and <span class="math inline">\(y^*_t\)</span> observed data points, as in the <a href="https://libbi.org/docs/LibBi-Manual.pdf" class="external-link">LibBi manual</a>). This
can be useful, for example, for comparing typical model trajectories to
the data, or for running the model beyond the last data point.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_bi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict.html">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">bi</span>, start_time <span class="op">=</span> <span class="fl">0</span>, end_time <span class="op">=</span> <span class="fl">20</span> <span class="op">*</span> <span class="fl">7</span>, output_every <span class="op">=</span> <span class="fl">7</span>,</span>
<span>  with <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"transform-obs-to-state"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>where <code>with=c("transform-obs-to-state")</code> tells LibBi to
treat observations as a state variable, that is to randomly generate
observations, i.e. samples from <span class="math inline">\(p(y_t|\theta)\)</span> where, again, <span class="math inline">\(\theta\)</span> are distributed according to the
posterior distribution <span class="math inline">\(p(\theta|y^*_t)\)</span> (see the
<code>with-transform-obs-to-state</code> option in the <a href="https://libbi.org/docs/LibBi-Manual.pdf" class="external-link">LibBi manual</a>).</p>
</div>
<div class="section level2">
<h2 id="sample-observations">Sample observations<a class="anchor" aria-label="anchor" href="#sample-observations"></a>
</h2>
<p>To sample observations from sampled posterior state trajectories,
that is samples from <span class="math inline">\(p(y_t|x_t)\)</span>
where the <span class="math inline">\(x_t\)</span> are distributed
according to the posterior distribution <span class="math inline">\(p(x_t | y_t)\)</span>, you can use.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obs_bi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_obs.html">sample_obs</a></span><span class="op">(</span><span class="va">bi</span><span class="op">)</span></span></code></pre></div>
<p>Compare this to the data:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">obs_bi</span>, type <span class="op">=</span> <span class="st">"obs"</span><span class="op">)</span></span>
<span><span class="co">#&gt;          var time Min. 1st Qu. Median    Mean 3rd Qu. Max.</span></span>
<span><span class="co">#&gt; 1  Incidence    0    0       0      0   0.490       1    4</span></span>
<span><span class="co">#&gt; 2  Incidence    7    0       0      0   0.698       1    6</span></span>
<span><span class="co">#&gt; 3  Incidence   14    0       0      1   1.391       2    7</span></span>
<span><span class="co">#&gt; 4  Incidence   21    0       2      4   3.899       5   16</span></span>
<span><span class="co">#&gt; 5  Incidence   28    0      37     44  44.200      52   80</span></span>
<span><span class="co">#&gt; 6  Incidence   35    0     106    116 115.630     127  170</span></span>
<span><span class="co">#&gt; 7  Incidence   42    0      88     98  96.952     108  148</span></span>
<span><span class="co">#&gt; 8  Incidence   49    0      39     45  45.241      52   80</span></span>
<span><span class="co">#&gt; 9  Incidence   56    0       2      3   3.634       5   15</span></span>
<span><span class="co">#&gt; 10 Incidence   63    0       1      2   2.359       3   12</span></span>
<span><span class="co">#&gt; 11 Incidence   70    0       0      0   0.656       1    6</span></span>
<span><span class="co">#&gt; 12 Incidence   77    0       0      0   0.275       0    5</span></span>
<span><span class="co">#&gt; 13 Incidence   84    0       0      0   0.123       0    3</span></span>
<span><span class="co">#&gt; 14 Incidence   91    0       0      0   0.053       0    2</span></span>
<span><span class="co">#&gt; 15 Incidence   98    0       0      0   0.041       0    2</span></span>
<span><span class="co">#&gt; 16 Incidence  105    0       0      0   0.017       0    1</span></span>
<span><span class="co">#&gt; 17 Incidence  112    0       0      0   0.008       0    1</span></span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span></span>
<span><span class="co">#&gt;    time value</span></span>
<span><span class="co">#&gt; 1     0     1</span></span>
<span><span class="co">#&gt; 2     7     0</span></span>
<span><span class="co">#&gt; 3    14     1</span></span>
<span><span class="co">#&gt; 4    21     3</span></span>
<span><span class="co">#&gt; 5    28    46</span></span>
<span><span class="co">#&gt; 6    35   120</span></span>
<span><span class="co">#&gt; 7    42    97</span></span>
<span><span class="co">#&gt; 8    49    48</span></span>
<span><span class="co">#&gt; 9    56     2</span></span>
<span><span class="co">#&gt; 10   63     3</span></span>
<span><span class="co">#&gt; 11   70     0</span></span>
<span><span class="co">#&gt; 12   77     0</span></span>
<span><span class="co">#&gt; 13   84     0</span></span>
<span><span class="co">#&gt; 14   91     0</span></span>
<span><span class="co">#&gt; 15   98     0</span></span>
<span><span class="co">#&gt; 16  105     0</span></span>
<span><span class="co">#&gt; 17  112     0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h2>
<p>The other so-called clients of LibBi (besides <code>sample</code>)
are supported through commands of the same name: `filter, optimise and
rewrite. For example, to run a particle filter on the last posterior
sample generated above, you can use:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bi_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/filter.html">filter</a></span><span class="op">(</span><span class="va">bi</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<p>Output form LibBi runs can be visualised using standard R plotting
routines or plotting packages such as <code>ggplot2</code>. The
<code>summary</code> function can help with this. For example, to plot
observations randomly generated from the posterior distribution of the
parameters and compare them to the data we can use</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">pred_bi</span>, type <span class="op">=</span> <span class="st">"obs"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ps</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">`1st Qu.`</span>, ymax <span class="op">=</span> <span class="va">`3rd Qu.`</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span>, color <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"cases"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rbi_files/figure-html/unnamed-chunk-43-1.png" width="700"></p>
<p>where we have plotted the median fit as a black line, the
interquartile range as a grey ribbon, and the data points as dark red
dots. Compare this to observations randomly generated from the posterior
distribution of trajectories:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">os</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summary.html">summary</a></span><span class="op">(</span><span class="va">obs_bi</span>, type <span class="op">=</span> <span class="st">"obs"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">os</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">`1st Qu.`</span>, ymax <span class="op">=</span> <span class="va">`3rd Qu.`</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, <span class="va">dataset</span><span class="op">$</span><span class="va">Incidence</span>, color <span class="op">=</span> <span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"cases"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rbi_files/figure-html/unnamed-chunk-44-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="saving-and-loading-libbi-objects">Saving and loading <code>libbi</code> objects<a class="anchor" aria-label="anchor" href="#saving-and-loading-libbi-objects"></a>
</h2>
<p><strong>rbi</strong> provides its own versions of the
<code>saveRDS</code> and <code>readRDS</code> functions called
<code>save_libbi</code> and <code>read_libbi</code>. These make sure
that all information (including any options, input, init and observation
files) is stored in the object.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_libbi.html">save_libbi</a></span><span class="op">(</span><span class="va">bi</span>, <span class="st">"bi.rds"</span><span class="op">)</span></span>
<span><span class="va">bi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_libbi.html">read_libbi</a></span><span class="op">(</span><span class="st">"bi.rds"</span><span class="op">)</span></span>
<span><span class="va">bi</span></span>
<span><span class="co">#&gt; Wrapper around LibBi</span></span>
<span><span class="co">#&gt; ======================</span></span>
<span><span class="co">#&gt; Model:  SIR </span></span>
<span><span class="co">#&gt; Run time:  5.796949  seconds</span></span>
<span><span class="co">#&gt; Number of samples:  1000 </span></span>
<span><span class="co">#&gt; State trajectories recorded:  S I R Z </span></span>
<span><span class="co">#&gt; Noise trajectories recorded:  n_transmission n_recovery </span></span>
<span><span class="co">#&gt; Parameters recorded:  p_rep p_R0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-libbi-objects-from-previous-runs">Creating <code>libbi</code> objects from previous runs<a class="anchor" aria-label="anchor" href="#creating-libbi-objects-from-previous-runs"></a>
</h2>
<p>To recreate a <code>libbi</code> object from a previous R session,
use <code>attach_data</code>. For example, one could use the following
code to get the acceptance rate for a <em>LibBi</em> run with a given
output and model file:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pz_run_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bi_read.html">bi_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"rbi"</span>, <span class="st">"example_output.nc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pz_model_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"rbi"</span>, <span class="st">"PZ.bi"</span><span class="op">)</span></span>
<span><span class="va">pz_posterior</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/attach_data.html">attach_data</a></span><span class="op">(</span><span class="fu"><a href="../reference/libbi.html">libbi</a></span><span class="op">(</span><span class="va">pz_model_file</span><span class="op">)</span>, <span class="st">"output"</span>, <span class="va">pz_run_output</span><span class="op">)</span></span>
<span><span class="va">traces</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">mcmc</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_traces.html">get_traces</a></span><span class="op">(</span><span class="va">pz_posterior</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/coda/man/rejectionRate.html" class="external-link">rejectionRate</a></span><span class="op">(</span><span class="va">traces</span><span class="op">)</span></span>
<span><span class="va">a</span></span>
<span><span class="co">#&gt;        mu     sigma </span></span>
<span><span class="co">#&gt; 0.4724409 0.4724409</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h2>
<p>For a general check of model syntax, the <code>rewrite</code> command
is useful:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rewrite.html">rewrite</a></span><span class="op">(</span><span class="va">sir_model</span><span class="op">)</span></span></code></pre></div>
<p>This generates the internal representation of the model for LibBi. It
doesn’t matter so much what this looks like, but it will throw an error
if there is a problem. If <code>libbi</code> throws an error, it is best
to investigate with <code>debug = TRUE</code>, and setting
<code>working_folder</code> to a folder that one can then use for
debugging. Output of the <code>libbi</code> call can be saved in a file
using the <code>log_file_name</code> option (by default a temporary
file).</p>
</div>
<div class="section level2">
<h2 id="related-packages">Related packages<a class="anchor" aria-label="anchor" href="#related-packages"></a>
</h2>
<p><a href="https://github.com/sbfnk/rbi.helpers" class="external-link">rbi.helpers</a>
contains higher-level methods to interact with <strong>LibBi</strong>,
including methods for plotting the results of libbi runs and for
adapting the proposal distribution and number of particles. For more
information, see the <a href="http://sbfnk.github.io/rbi.helpers/articles/introduction.html" class="external-link">rbi.helpers
vignette</a>.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Murray, L.M. (2013). <a href="https://arxiv.org/abs/1306.3277" class="external-link">Bayesian state-space modelling on
high-performance hardware using LibBi</a>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pierre E. Jacob, Sebastian Funk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
